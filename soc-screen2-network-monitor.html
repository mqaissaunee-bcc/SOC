<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOC Screen 2: Network Monitor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .header {
            background: linear-gradient(90deg, #1a1a2e 0%, #16213e 100%);
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #0f4c75;
        }
        
        .header h1 {
            font-size: 1.8em;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
        
        .header-info {
            display: flex;
            gap: 30px;
            align-items: center;
        }
        
        .datetime {
            font-size: 1.1em;
            color: #00d4ff;
        }
        
        .network-status {
            display: flex;
            gap: 20px;
        }
        
        .network-stat {
            text-align: center;
        }
        
        .network-stat-value {
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .network-stat-label {
            font-size: 0.75em;
            color: #888;
        }
        
        .main-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto 1fr 1fr;
            gap: 15px;
            padding: 15px;
            height: calc(100vh - 80px);
        }
        
        .card {
            background: linear-gradient(145deg, #1e1e30 0%, #252540 100%);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #333;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }
        
        .card-title {
            font-size: 1.1em;
            color: #00d4ff;
            font-weight: 600;
        }
        
        /* World Map */
        .world-map-section {
            grid-column: 1 / -1;
        }
        
        .world-map-container {
            position: relative;
            width: 100%;
            height: 280px;
            background: #0d1421;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .world-map {
            width: 100%;
            height: 100%;
            opacity: 0.6;
        }
        
        .attack-point {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            z-index: 10;
        }
        
        .attack-point::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            animation: attackPulse 2s infinite;
        }
        
        .attack-point.critical { background: #ff4757; }
        .attack-point.critical::before { background: rgba(255, 71, 87, 0.4); }
        .attack-point.high { background: #ffa502; }
        .attack-point.high::before { background: rgba(255, 165, 2, 0.4); }
        .attack-point.medium { background: #ffd43b; }
        .attack-point.medium::before { background: rgba(255, 212, 59, 0.4); }
        
        @keyframes attackPulse {
            0% { width: 100%; height: 100%; opacity: 1; }
            100% { width: 300%; height: 300%; opacity: 0; }
        }
        
        .attack-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, rgba(255,71,87,0.8), transparent);
            transform-origin: left center;
            animation: attackLine 2s forwards;
            z-index: 5;
        }
        
        @keyframes attackLine {
            0% { width: 0; opacity: 1; }
            100% { width: 100%; opacity: 0; }
        }
        
        .map-legend {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.8em;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }
        
        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .map-stats {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 20px;
        }
        
        .map-stat {
            background: rgba(0,0,0,0.7);
            padding: 10px 15px;
            border-radius: 8px;
        }
        
        .map-stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #ff4757;
        }
        
        .map-stat-label {
            font-size: 0.75em;
            color: #888;
        }
        
        /* Traffic Graph */
        .traffic-graph {
            height: 180px;
            position: relative;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .traffic-canvas {
            width: 100%;
            height: 100%;
        }
        
        .traffic-legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 10px;
            font-size: 0.85em;
        }
        
        .traffic-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .traffic-legend-color {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }
        
        /* Firewall Logs */
        .firewall-logs {
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .log-list {
            flex: 1;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85em;
        }
        
        .log-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .log-list::-webkit-scrollbar-track {
            background: #1a1a2e;
        }
        
        .log-list::-webkit-scrollbar-thumb {
            background: #00d4ff;
            border-radius: 3px;
        }
        
        .log-entry {
            padding: 8px 10px;
            border-bottom: 1px solid #2a2a40;
            display: grid;
            grid-template-columns: 90px 70px 140px 140px 80px 60px 1fr;
            gap: 10px;
            align-items: center;
            animation: logSlide 0.3s ease;
        }
        
        @keyframes logSlide {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .log-entry:hover {
            background: rgba(0, 212, 255, 0.1);
        }
        
        .log-time {
            color: #888;
        }
        
        .log-action {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            text-align: center;
        }
        
        .log-action.allow {
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
        }
        
        .log-action.deny {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
        }
        
        .log-action.drop {
            background: rgba(255, 165, 2, 0.2);
            color: #ffa502;
        }
        
        .log-protocol {
            color: #00d4ff;
        }
        
        /* Top Talkers */
        .top-talkers {
            display: flex;
            flex-direction: column;
        }
        
        .talker-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .talker-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #2a2a40;
        }
        
        .talker-rank {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #3498db, #00d4ff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .talker-info {
            flex: 1;
        }
        
        .talker-ip {
            font-weight: 600;
            font-family: monospace;
        }
        
        .talker-country {
            font-size: 0.85em;
            color: #888;
        }
        
        .talker-bar-container {
            width: 150px;
            height: 8px;
            background: #2a2a40;
            border-radius: 4px;
            overflow: hidden;
            margin-right: 15px;
        }
        
        .talker-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff4757, #ffa502);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .talker-value {
            width: 80px;
            text-align: right;
            font-family: monospace;
            color: #00d4ff;
        }
        
        /* Port Activity */
        .port-activity {
            display: flex;
            flex-direction: column;
        }
        
        .port-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            flex: 1;
        }
        
        .port-item {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid #333;
            transition: all 0.3s ease;
        }
        
        .port-item:hover {
            border-color: #00d4ff;
            transform: scale(1.02);
        }
        
        .port-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #00d4ff;
        }
        
        .port-service {
            font-size: 0.85em;
            color: #888;
            margin: 5px 0;
        }
        
        .port-connections {
            font-size: 0.9em;
        }
        
        .port-status {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .port-status.active {
            background: #2ed573;
            box-shadow: 0 0 10px #2ed573;
        }
        
        .port-status.warning {
            background: #ffa502;
            animation: blink 1s infinite;
        }
        
        .port-status.alert {
            background: #ff4757;
            animation: blink 0.5s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* SVG Map */
        .svg-world {
            width: 100%;
            height: 100%;
        }
        
        .country {
            fill: #1a3a5c;
            stroke: #2a5a8c;
            stroke-width: 0.5;
        }
        
        .country:hover {
            fill: #2a5a8c;
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>üåê Network Traffic Monitor</h1>
        <div class="header-info">
            <div class="network-status">
                <div class="network-stat">
                    <div class="network-stat-value" style="color: #2ed573;" id="inbound-speed">0</div>
                    <div class="network-stat-label">Inbound Gbps</div>
                </div>
                <div class="network-stat">
                    <div class="network-stat-value" style="color: #00d4ff;" id="outbound-speed">0</div>
                    <div class="network-stat-label">Outbound Gbps</div>
                </div>
                <div class="network-stat">
                    <div class="network-stat-value" style="color: #ffa502;" id="active-connections">0</div>
                    <div class="network-stat-label">Active Conn.</div>
                </div>
            </div>
            <div class="datetime" id="datetime"></div>
        </div>
    </header>
    
    <main class="main-container">
        <!-- World Map -->
        <div class="card world-map-section">
            <div class="card-header">
                <span class="card-title">üó∫Ô∏è Global Threat Map - Live Attack Visualization</span>
                <span id="attacks-per-min">0 attacks/min</span>
            </div>
            <div class="world-map-container" id="map-container">
                <svg class="svg-world" viewBox="0 0 1000 500" id="world-svg">
                    <!-- Simplified world map paths -->
                    <path class="country" d="M165,120 L220,115 L240,130 L235,160 L200,165 L170,155 Z" title="USA"/>
                    <path class="country" d="M240,130 L280,125 L285,160 L240,165 Z" title="East USA"/>
                    <path class="country" d="M170,155 L165,200 L210,210 L230,190 L235,160 Z" title="Mexico"/>
                    <path class="country" d="M230,220 L280,200 L320,230 L290,280 L240,270 Z" title="Brazil"/>
                    <path class="country" d="M420,100 L480,95 L500,120 L490,150 L450,155 L420,140 Z" title="UK/Europe"/>
                    <path class="country" d="M500,120 L560,110 L580,140 L570,170 L520,175 L500,150 Z" title="Central Europe"/>
                    <path class="country" d="M560,110 L700,90 L750,130 L720,180 L600,190 L570,150 Z" title="Russia"/>
                    <path class="country" d="M520,175 L560,170 L570,200 L550,230 L510,225 Z" title="Middle East"/>
                    <path class="country" d="M480,200 L520,195 L530,250 L470,260 L450,230 Z" title="Africa North"/>
                    <path class="country" d="M470,260 L530,255 L540,320 L480,330 L460,300 Z" title="Africa South"/>
                    <path class="country" d="M650,150 L720,140 L740,180 L720,220 L670,215 L650,180 Z" title="India"/>
                    <path class="country" d="M740,130 L800,120 L820,160 L800,200 L760,195 L740,160 Z" title="China"/>
                    <path class="country" d="M820,160 L850,155 L860,180 L845,200 L820,195 Z" title="Korea"/>
                    <path class="country" d="M860,170 L890,165 L900,200 L880,220 L855,210 Z" title="Japan"/>
                    <path class="country" d="M780,260 L840,250 L870,300 L820,340 L770,320 Z" title="Australia"/>
                </svg>
                
                <div class="map-stats">
                    <div class="map-stat">
                        <div class="map-stat-value" id="blocked-attacks">0</div>
                        <div class="map-stat-label">Blocked Today</div>
                    </div>
                    <div class="map-stat">
                        <div class="map-stat-value" style="color: #ffa502;" id="suspicious-ips">0</div>
                        <div class="map-stat-label">Suspicious IPs</div>
                    </div>
                </div>
                
                <div class="map-legend">
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #ff4757;"></div>
                        <span>Critical</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #ffa502;"></div>
                        <span>High</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #ffd43b;"></div>
                        <span>Medium</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Traffic Graph -->
        <div class="card">
            <div class="card-header">
                <span class="card-title">üìà Network Traffic (Real-Time)</span>
            </div>
            <div class="traffic-graph">
                <canvas id="traffic-canvas" class="traffic-canvas"></canvas>
            </div>
            <div class="traffic-legend">
                <div class="traffic-legend-item">
                    <div class="traffic-legend-color" style="background: #2ed573;"></div>
                    <span>Inbound</span>
                </div>
                <div class="traffic-legend-item">
                    <div class="traffic-legend-color" style="background: #00d4ff;"></div>
                    <span>Outbound</span>
                </div>
                <div class="traffic-legend-item">
                    <div class="traffic-legend-color" style="background: #ff4757;"></div>
                    <span>Blocked</span>
                </div>
            </div>
        </div>
        
        <!-- Top Talkers -->
        <div class="card top-talkers">
            <div class="card-header">
                <span class="card-title">üîù Top Talkers (External IPs)</span>
            </div>
            <div class="talker-list" id="talker-list"></div>
        </div>
        
        <!-- Firewall Logs -->
        <div class="card firewall-logs">
            <div class="card-header">
                <span class="card-title">üî• Firewall Logs (Live)</span>
                <span id="log-count">0 events</span>
            </div>
            <div class="log-list" id="log-list">
                <div class="log-entry" style="background: rgba(0,212,255,0.1); font-weight: bold;">
                    <span>Time</span>
                    <span>Action</span>
                    <span>Source IP</span>
                    <span>Dest IP</span>
                    <span>Port</span>
                    <span>Proto</span>
                    <span>Rule</span>
                </div>
            </div>
        </div>
        
        <!-- Port Activity -->
        <div class="card port-activity">
            <div class="card-header">
                <span class="card-title">üîå Port Activity Monitor</span>
            </div>
            <div class="port-grid" id="port-grid"></div>
        </div>
    </main>
    
    <script>
        // Configuration
        const countries = [
            // North America
            { name: 'United States', code: 'US', x: 200, y: 140 },
            { name: 'Canada', code: 'CA', x: 190, y: 100 },
            { name: 'Mexico', code: 'MX', x: 170, y: 175 },
            // South America
            { name: 'Brazil', code: 'BR', x: 280, y: 260 },
            { name: 'Argentina', code: 'AR', x: 260, y: 310 },
            { name: 'Colombia', code: 'CO', x: 240, y: 215 },
            { name: 'Venezuela', code: 'VE', x: 255, y: 200 },
            { name: 'Chile', code: 'CL', x: 245, y: 300 },
            // Europe
            { name: 'Germany', code: 'DE', x: 500, y: 130 },
            { name: 'UK', code: 'UK', x: 450, y: 115 },
            { name: 'France', code: 'FR', x: 470, y: 140 },
            { name: 'Netherlands', code: 'NL', x: 485, y: 120 },
            { name: 'Ukraine', code: 'UA', x: 560, y: 135 },
            { name: 'Poland', code: 'PL', x: 520, y: 125 },
            { name: 'Romania', code: 'RO', x: 540, y: 145 },
            { name: 'Sweden', code: 'SE', x: 510, y: 95 },
            { name: 'Italy', code: 'IT', x: 505, y: 150 },
            { name: 'Spain', code: 'ES', x: 455, y: 155 },
            { name: 'Bulgaria', code: 'BG', x: 540, y: 150 },
            { name: 'Czech Republic', code: 'CZ', x: 510, y: 130 },
            // Russia & CIS
            { name: 'Russia', code: 'RU', x: 650, y: 120 },
            { name: 'Kazakhstan', code: 'KZ', x: 620, y: 145 },
            { name: 'Belarus', code: 'BY', x: 545, y: 125 },
            // Middle East
            { name: 'Iran', code: 'IR', x: 590, y: 175 },
            { name: 'Turkey', code: 'TR', x: 555, y: 160 },
            { name: 'Israel', code: 'IL', x: 560, y: 180 },
            { name: 'Saudi Arabia', code: 'SA', x: 580, y: 195 },
            { name: 'UAE', code: 'AE', x: 600, y: 195 },
            // Asia
            { name: 'China', code: 'CN', x: 780, y: 160 },
            { name: 'India', code: 'IN', x: 680, y: 190 },
            { name: 'Japan', code: 'JP', x: 870, y: 180 },
            { name: 'South Korea', code: 'KR', x: 840, y: 175 },
            { name: 'Vietnam', code: 'VN', x: 760, y: 200 },
            { name: 'Indonesia', code: 'ID', x: 780, y: 245 },
            { name: 'Thailand', code: 'TH', x: 740, y: 200 },
            { name: 'Malaysia', code: 'MY', x: 755, y: 225 },
            { name: 'Philippines', code: 'PH', x: 810, y: 205 },
            { name: 'Singapore', code: 'SG', x: 755, y: 235 },
            { name: 'Taiwan', code: 'TW', x: 820, y: 190 },
            { name: 'Pakistan', code: 'PK', x: 650, y: 180 },
            { name: 'Bangladesh', code: 'BD', x: 700, y: 195 },
            // Africa
            { name: 'South Africa', code: 'ZA', x: 540, y: 300 },
            { name: 'Nigeria', code: 'NG', x: 490, y: 220 },
            { name: 'Egypt', code: 'EG', x: 550, y: 185 },
            { name: 'Morocco', code: 'MA', x: 450, y: 175 },
            { name: 'Kenya', code: 'KE', x: 565, y: 240 },
            // Oceania
            { name: 'Australia', code: 'AU', x: 820, y: 300 },
            { name: 'New Zealand', code: 'NZ', x: 890, y: 330 }
        ];
        
        const targetLocation = { x: 220, y: 145 }; // Our network location (simulated)
        
        const firewallActions = ['ALLOW', 'DENY', 'DROP'];
        const protocols = ['TCP', 'UDP', 'ICMP', 'HTTP', 'HTTPS', 'SSH', 'DNS', 'FTP', 'SMTP', 'IMAP', 'POP3', 'SMB', 'RDP', 'LDAP', 'Kerberos', 'NTP', 'SNMP', 'SIP', 'MQTT', 'gRPC'];
        const firewallRules = [
            'Default-Allow', 'Block-Known-Bad', 'Rate-Limit', 'Geo-Block',
            'Port-Scan-Detect', 'IDS-Alert', 'WAF-Block', 'DDoS-Protect',
            'Malware-Block', 'C2-Block', 'Botnet-Block', 'Tor-Block',
            'VPN-Detect', 'Crypto-Mining-Block', 'SQL-Injection-Block',
            'XSS-Block', 'CSRF-Protect', 'Brute-Force-Protect', 'Zero-Day-Block',
            'APT-Indicator', 'Ransomware-Block', 'Phishing-Block'
        ];
        
        const monitoredPorts = [
            { port: 22, service: 'SSH', connections: 0, status: 'active' },
            { port: 80, service: 'HTTP', connections: 0, status: 'active' },
            { port: 443, service: 'HTTPS', connections: 0, status: 'active' },
            { port: 3389, service: 'RDP', connections: 0, status: 'warning' },
            { port: 3306, service: 'MySQL', connections: 0, status: 'active' },
            { port: 1433, service: 'MSSQL', connections: 0, status: 'active' },
            { port: 21, service: 'FTP', connections: 0, status: 'alert' },
            { port: 25, service: 'SMTP', connections: 0, status: 'active' },
            { port: 53, service: 'DNS', connections: 0, status: 'active' },
            { port: 5432, service: 'PostgreSQL', connections: 0, status: 'active' },
            { port: 6379, service: 'Redis', connections: 0, status: 'warning' },
            { port: 27017, service: 'MongoDB', connections: 0, status: 'active' },
            { port: 8080, service: 'HTTP-Alt', connections: 0, status: 'active' },
            { port: 8443, service: 'HTTPS-Alt', connections: 0, status: 'active' },
            { port: 445, service: 'SMB', connections: 0, status: 'warning' },
            { port: 139, service: 'NetBIOS', connections: 0, status: 'alert' },
            { port: 389, service: 'LDAP', connections: 0, status: 'active' },
            { port: 636, service: 'LDAPS', connections: 0, status: 'active' },
            { port: 5900, service: 'VNC', connections: 0, status: 'warning' },
            { port: 1521, service: 'Oracle', connections: 0, status: 'active' }
        ];
        
        // State
        let attackCount = 0;
        let blockedCount = 8547;
        let suspiciousIPs = 234;
        let logCount = 0;
        let topTalkers = [];
        
        // Traffic data
        let trafficData = {
            inbound: Array(60).fill(0),
            outbound: Array(60).fill(0),
            blocked: Array(60).fill(0)
        };
        
        // Initialize top talkers
        function initTopTalkers() {
            const ips = [];
            for (let i = 0; i < 10; i++) {
                const country = countries[Math.floor(Math.random() * countries.length)];
                ips.push({
                    ip: `${Math.floor(Math.random() * 223) + 1}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`,
                    country: country.name,
                    bytes: Math.floor(Math.random() * 10000000) + 1000000
                });
            }
            topTalkers = ips.sort((a, b) => b.bytes - a.bytes);
        }
        
        // Render top talkers
        function renderTopTalkers() {
            const list = document.getElementById('talker-list');
            const maxBytes = topTalkers[0].bytes;
            
            list.innerHTML = topTalkers.map((talker, i) => `
                <div class="talker-item">
                    <div class="talker-rank">${i + 1}</div>
                    <div class="talker-info">
                        <div class="talker-ip">${talker.ip}</div>
                        <div class="talker-country">${talker.country}</div>
                    </div>
                    <div class="talker-bar-container">
                        <div class="talker-bar" style="width: ${(talker.bytes / maxBytes) * 100}%"></div>
                    </div>
                    <div class="talker-value">${formatBytes(talker.bytes)}</div>
                </div>
            `).join('');
        }
        
        // Format bytes
        function formatBytes(bytes) {
            if (bytes >= 1000000) return (bytes / 1000000).toFixed(1) + ' MB';
            if (bytes >= 1000) return (bytes / 1000).toFixed(1) + ' KB';
            return bytes + ' B';
        }
        
        // Add attack point to map
        function addAttackPoint() {
            const container = document.getElementById('map-container');
            const source = countries[Math.floor(Math.random() * countries.length)];
            const severities = ['critical', 'high', 'medium'];
            const severity = severities[Math.floor(Math.random() * severities.length)];
            
            // Create attack point
            const point = document.createElement('div');
            point.className = `attack-point ${severity}`;
            point.style.left = `${(source.x / 1000) * 100}%`;
            point.style.top = `${(source.y / 500) * 100}%`;
            point.title = `Attack from ${source.name}`;
            
            container.appendChild(point);
            
            // Create attack line
            const line = document.createElement('div');
            line.className = 'attack-line';
            const dx = (targetLocation.x - source.x);
            const dy = (targetLocation.y - source.y);
            const length = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            
            line.style.left = `${(source.x / 1000) * 100}%`;
            line.style.top = `${(source.y / 500) * 100}%`;
            line.style.width = `${(length / 1000) * 100}%`;
            line.style.transform = `rotate(${angle}deg)`;
            
            container.appendChild(line);
            
            // Remove after animation
            setTimeout(() => {
                point.remove();
                line.remove();
            }, 3000);
            
            attackCount++;
        }
        
        // Add firewall log
        function addFirewallLog() {
            const list = document.getElementById('log-list');
            const action = firewallActions[Math.floor(Math.random() * firewallActions.length)];
            const protocol = protocols[Math.floor(Math.random() * protocols.length)];
            const rule = firewallRules[Math.floor(Math.random() * firewallRules.length)];
            
            const sourceIP = `${Math.floor(Math.random() * 223) + 1}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
            const destIP = `10.0.${Math.floor(Math.random() * 10)}.${Math.floor(Math.random() * 255)}`;
            const port = [22, 80, 443, 3389, 3306, 21, 25, 8080, 445, 139][Math.floor(Math.random() * 10)];
            
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `
                <span class="log-time">${new Date().toLocaleTimeString()}</span>
                <span class="log-action ${action.toLowerCase()}">${action}</span>
                <span>${sourceIP}</span>
                <span>${destIP}</span>
                <span>${port}</span>
                <span class="log-protocol">${protocol}</span>
                <span>${rule}</span>
            `;
            
            // Insert after header
            const header = list.querySelector('.log-entry');
            header.after(entry);
            
            // Keep only last 50 entries
            const entries = list.querySelectorAll('.log-entry');
            if (entries.length > 51) {
                entries[entries.length - 1].remove();
            }
            
            logCount++;
            document.getElementById('log-count').textContent = `${logCount} events`;
            
            if (action === 'DENY' || action === 'DROP') {
                blockedCount++;
            }
        }
        
        // Render port grid
        function renderPortGrid() {
            const grid = document.getElementById('port-grid');
            grid.innerHTML = monitoredPorts.map(port => `
                <div class="port-item">
                    <div class="port-number">${port.port}</div>
                    <div class="port-service">${port.service}</div>
                    <div class="port-connections">
                        <span class="port-status ${port.status}"></span>
                        <span id="port-${port.port}">${port.connections}</span> conn
                    </div>
                </div>
            `).join('');
        }
        
        // Update port connections
        function updatePortConnections() {
            monitoredPorts.forEach(port => {
                const change = Math.floor(Math.random() * 20) - 5;
                port.connections = Math.max(0, port.connections + change);
                const el = document.getElementById(`port-${port.port}`);
                if (el) el.textContent = port.connections;
                
                // Update status based on connections
                if (port.connections > 500) {
                    port.status = 'alert';
                } else if (port.connections > 200) {
                    port.status = 'warning';
                } else {
                    port.status = 'active';
                }
            });
            renderPortGrid();
        }
        
        // Draw traffic graph
        function drawTrafficGraph() {
            const canvas = document.getElementById('traffic-canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size
            canvas.width = canvas.offsetWidth * 2;
            canvas.height = canvas.offsetHeight * 2;
            ctx.scale(2, 2);
            
            const width = canvas.offsetWidth;
            const height = canvas.offsetHeight;
            
            ctx.clearRect(0, 0, width, height);
            
            // Draw grid
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 0.5;
            for (let i = 0; i < 5; i++) {
                const y = (height / 5) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // Draw data
            const drawLine = (data, color) => {
                const max = Math.max(...data, 100);
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                data.forEach((value, i) => {
                    const x = (width / (data.length - 1)) * i;
                    const y = height - (value / max) * (height - 20);
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                
                ctx.stroke();
            };
            
            drawLine(trafficData.inbound, '#2ed573');
            drawLine(trafficData.outbound, '#00d4ff');
            drawLine(trafficData.blocked, '#ff4757');
        }
        
        // Update traffic data
        function updateTrafficData() {
            trafficData.inbound.shift();
            trafficData.inbound.push(Math.floor(Math.random() * 80) + 20);
            
            trafficData.outbound.shift();
            trafficData.outbound.push(Math.floor(Math.random() * 60) + 10);
            
            trafficData.blocked.shift();
            trafficData.blocked.push(Math.floor(Math.random() * 20));
            
            drawTrafficGraph();
            
            // Update header stats
            document.getElementById('inbound-speed').textContent = 
                (trafficData.inbound[trafficData.inbound.length - 1] / 10).toFixed(2);
            document.getElementById('outbound-speed').textContent = 
                (trafficData.outbound[trafficData.outbound.length - 1] / 10).toFixed(2);
            document.getElementById('active-connections').textContent = 
                Math.floor(Math.random() * 5000) + 10000;
        }
        
        // Update stats
        function updateStats() {
            document.getElementById('blocked-attacks').textContent = blockedCount.toLocaleString();
            document.getElementById('suspicious-ips').textContent = suspiciousIPs;
            document.getElementById('attacks-per-min').textContent = `${Math.floor(attackCount / 2)} attacks/min`;
            
            // Reset attack count every minute
            if (attackCount > 60) attackCount = 0;
        }
        
        // Update datetime
        function updateDateTime() {
            document.getElementById('datetime').textContent = 
                new Date().toLocaleString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
        }
        
        // Update top talkers periodically
        function updateTopTalkers() {
            topTalkers.forEach(talker => {
                talker.bytes += Math.floor(Math.random() * 100000);
            });
            topTalkers.sort((a, b) => b.bytes - a.bytes);
            renderTopTalkers();
        }
        
        // Initialize
        function init() {
            initTopTalkers();
            renderTopTalkers();
            renderPortGrid();
            
            // Initialize traffic data
            for (let i = 0; i < 60; i++) {
                trafficData.inbound[i] = Math.floor(Math.random() * 80) + 20;
                trafficData.outbound[i] = Math.floor(Math.random() * 60) + 10;
                trafficData.blocked[i] = Math.floor(Math.random() * 20);
            }
            drawTrafficGraph();
            
            // Initialize port connections
            monitoredPorts.forEach(port => {
                port.connections = Math.floor(Math.random() * 300);
            });
            renderPortGrid();
            
            updateDateTime();
            updateStats();
            
            // Set intervals
            setInterval(updateDateTime, 1000);
            setInterval(addAttackPoint, 500);
            setInterval(addFirewallLog, 800);
            setInterval(updateTrafficData, 1000);
            setInterval(updatePortConnections, 3000);
            setInterval(updateStats, 2000);
            setInterval(updateTopTalkers, 5000);
            
            // Handle resize
            window.addEventListener('resize', drawTrafficGraph);
        }
        
        init();
    </script>
</body>
</html>
