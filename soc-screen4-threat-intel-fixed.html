<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOC Screen 4: Threat Intel & Endpoint Status</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .header {
            background: linear-gradient(90deg, #1a1a2e 0%, #16213e 100%);
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #9b59b6;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .header h1 {
            font-size: 1.8em;
            color: #9b59b6;
            text-shadow: 0 0 10px rgba(155, 89, 182, 0.5);
        }
        
        .header-info {
            display: flex;
            gap: 30px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .datetime {
            font-size: 1.1em;
            color: #9b59b6;
        }
        
        .endpoint-summary {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .endpoint-stat {
            text-align: center;
            padding: 5px 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }
        
        .endpoint-stat-value {
            font-size: 1.3em;
            font-weight: bold;
        }
        
        .endpoint-stat-label {
            font-size: 0.7em;
            color: #888;
            text-transform: uppercase;
        }
        
        /* FIXED: min-height and improved grid rows */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto minmax(280px, 1fr) minmax(280px, 1fr);
            gap: 15px;
            padding: 15px;
            min-height: calc(100vh - 80px);
        }
        
        /* FIXED: Proper flex container */
        .card {
            background: linear-gradient(145deg, #1e1e30 0%, #252540 100%);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid #333;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            min-height: 250px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
            flex-shrink: 0;
        }
        
        .card-title {
            font-size: 1em;
            color: #9b59b6;
            font-weight: 600;
        }
        
        /* Threat Feed Section */
        .threat-feed {
            grid-column: 1 / -1;
            min-height: auto;
        }
        
        .feed-container {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .feed-container::-webkit-scrollbar {
            height: 6px;
        }
        
        .feed-container::-webkit-scrollbar-thumb {
            background: #9b59b6;
            border-radius: 3px;
        }
        
        .threat-card {
            min-width: 280px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid;
            flex-shrink: 0;
        }
        
        .threat-card.critical { border-left-color: #ff4757; }
        .threat-card.high { border-left-color: #ffa502; }
        .threat-card.medium { border-left-color: #ffd43b; }
        
        .threat-source {
            font-size: 0.75em;
            color: #888;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .threat-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        
        .threat-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .threat-tag {
            padding: 2px 8px;
            background: rgba(155, 89, 182, 0.2);
            color: #9b59b6;
            border-radius: 10px;
            font-size: 0.75em;
        }
        
        /* Endpoint Grid - FIXED: proper overflow handling */
        .endpoint-grid-section {
            display: flex;
            flex-direction: column;
        }
        
        .endpoint-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
            min-height: 0;
        }
        
        .endpoint-grid::-webkit-scrollbar {
            width: 6px;
        }
        
        .endpoint-grid::-webkit-scrollbar-thumb {
            background: #9b59b6;
            border-radius: 3px;
        }
        
        .endpoint-tile {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        
        .endpoint-tile:hover {
            border-color: #9b59b6;
            transform: translateY(-2px);
        }
        
        .endpoint-icon {
            font-size: 2em;
            margin-bottom: 8px;
        }
        
        .endpoint-name {
            font-size: 0.85em;
            font-weight: 600;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .endpoint-status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .endpoint-status-indicator.healthy { background: #2ed573; }
        .endpoint-status-indicator.warning { background: #ffa502; animation: blink 1s infinite; }
        .endpoint-status-indicator.critical { background: #ff4757; animation: blink 0.5s infinite; }
        .endpoint-status-indicator.offline { background: #666; }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .endpoint-details {
            font-size: 0.75em;
            color: #888;
        }
        
        /* IOC Feed - FIXED: proper scrolling */
        .ioc-feed {
            display: flex;
            flex-direction: column;
        }
        
        .ioc-list {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }
        
        .ioc-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            margin-bottom: 8px;
            font-family: monospace;
            font-size: 0.85em;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .ioc-type-badge {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            min-width: 55px;
            text-align: center;
            flex-shrink: 0;
        }
        
        .ioc-type-badge.ip { background: rgba(231,76,60,0.3); color: #e74c3c; }
        .ioc-type-badge.hash { background: rgba(155,89,182,0.3); color: #9b59b6; }
        .ioc-type-badge.domain { background: rgba(52,152,219,0.3); color: #3498db; }
        .ioc-type-badge.url { background: rgba(46,213,115,0.3); color: #2ed573; }
        .ioc-type-badge.cve { background: rgba(241,196,15,0.3); color: #f1c40f; }
        
        .ioc-value {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .ioc-confidence {
            width: 60px;
            text-align: right;
            flex-shrink: 0;
        }
        
        .confidence-high { color: #ff4757; }
        .confidence-medium { color: #ffa502; }
        .confidence-low { color: #2ed573; }
        
        /* Vulnerability Panel - FIXED: proper scrolling */
        .vuln-panel {
            display: flex;
            flex-direction: column;
        }
        
        .vuln-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
            flex-shrink: 0;
        }
        
        .vuln-stat {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        
        .vuln-stat-value {
            font-size: 1.8em;
            font-weight: bold;
        }
        
        .vuln-stat-label {
            font-size: 0.75em;
            color: #888;
        }
        
        .vuln-list {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }
        
        .vuln-item {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid;
        }
        
        .vuln-item.critical { border-left-color: #ff4757; }
        .vuln-item.high { border-left-color: #ffa502; }
        .vuln-item.medium { border-left-color: #ffd43b; }
        .vuln-item.low { border-left-color: #2ed573; }
        
        .vuln-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .vuln-cve {
            font-weight: 600;
            color: #9b59b6;
        }
        
        .vuln-cvss {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .cvss-critical { background: rgba(255,71,87,0.3); color: #ff4757; }
        .cvss-high { background: rgba(255,165,2,0.3); color: #ffa502; }
        .cvss-medium { background: rgba(255,212,59,0.3); color: #ffd43b; }
        
        .vuln-title {
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .vuln-affected {
            font-size: 0.8em;
            color: #888;
        }
        
        /* EDR Alerts - FIXED: proper scrolling */
        .edr-alerts {
            display: flex;
            flex-direction: column;
        }
        
        .edr-list {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }
        
        .edr-alert {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid;
        }
        
        .edr-alert.malware { border-left-color: #ff4757; }
        .edr-alert.suspicious { border-left-color: #ffa502; }
        .edr-alert.pup { border-left-color: #ffd43b; }
        .edr-alert.blocked { border-left-color: #2ed573; }
        
        .edr-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .edr-type {
            font-weight: 600;
        }
        
        .edr-time {
            font-size: 0.8em;
            color: #888;
        }
        
        .edr-details {
            font-size: 0.85em;
            color: #aaa;
        }
        
        .edr-details-row {
            display: flex;
            gap: 20px;
            margin-top: 5px;
            flex-wrap: wrap;
        }
        
        .edr-detail {
            display: flex;
            gap: 5px;
        }
        
        .edr-detail-label {
            color: #666;
        }
        
        /* Compliance Widget */
        .compliance-section {
            display: flex;
            flex-direction: column;
        }
        
        .compliance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            flex: 1;
        }
        
        .compliance-item {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .compliance-score {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .compliance-label {
            font-size: 0.8em;
            color: #888;
        }
        
        .compliance-bar {
            height: 4px;
            background: #333;
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .compliance-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.5s ease;
        }
        
        /* Search/Filter */
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-shrink: 0;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            min-width: 150px;
            padding: 8px 12px;
            border: 1px solid #444;
            border-radius: 6px;
            background: rgba(0,0,0,0.3);
            color: #e0e0e0;
            font-size: 0.9em;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #9b59b6;
        }
        
        .filter-dropdown {
            padding: 8px 12px;
            border: 1px solid #444;
            border-radius: 6px;
            background: rgba(0,0,0,0.3);
            color: #e0e0e0;
            cursor: pointer;
        }
        
        /* FIXED: Responsive design */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto repeat(5, minmax(280px, auto));
            }
            .threat-feed,
            .endpoint-grid-section,
            .ioc-feed,
            .vuln-panel,
            .edr-alerts,
            .compliance-section {
                grid-column: 1;
            }
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .header h1 {
                font-size: 1.4em;
            }
            
            .threat-card {
                min-width: 220px;
            }
            
            .endpoint-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>üîç Threat Intelligence & Endpoint Status</h1>
        <div class="header-info">
            <div class="endpoint-summary">
                <div class="endpoint-stat">
                    <div class="endpoint-stat-value" style="color: #2ed573;" id="healthy-count">0</div>
                    <div class="endpoint-stat-label">Healthy</div>
                </div>
                <div class="endpoint-stat">
                    <div class="endpoint-stat-value" style="color: #ffa502;" id="warning-count">0</div>
                    <div class="endpoint-stat-label">Warning</div>
                </div>
                <div class="endpoint-stat">
                    <div class="endpoint-stat-value" style="color: #ff4757;" id="critical-count">0</div>
                    <div class="endpoint-stat-label">Critical</div>
                </div>
                <div class="endpoint-stat">
                    <div class="endpoint-stat-value" style="color: #666;" id="offline-count">0</div>
                    <div class="endpoint-stat-label">Offline</div>
                </div>
            </div>
            <div class="datetime" id="datetime"></div>
        </div>
    </header>
    
    <main class="main-container">
        <!-- Threat Feed -->
        <div class="card threat-feed">
            <div class="card-header">
                <span class="card-title">üì° Live Threat Intelligence Feed</span>
                <span id="feed-update">Updated just now</span>
            </div>
            <div class="feed-container" id="threat-feed"></div>
        </div>
        
        <!-- Endpoint Grid -->
        <div class="card endpoint-grid-section">
            <div class="card-header">
                <span class="card-title">üñ•Ô∏è Endpoint Status</span>
                <span id="endpoint-total">0 endpoints</span>
            </div>
            <div class="search-box">
                <input type="text" class="search-input" placeholder="Search endpoints..." id="endpoint-search">
                <select class="filter-dropdown" id="status-filter">
                    <option value="all">All Status</option>
                    <option value="healthy">Healthy</option>
                    <option value="warning">Warning</option>
                    <option value="critical">Critical</option>
                    <option value="offline">Offline</option>
                </select>
            </div>
            <div class="endpoint-grid" id="endpoint-grid"></div>
        </div>
        
        <!-- IOC Feed -->
        <div class="card ioc-feed">
            <div class="card-header">
                <span class="card-title">üéØ Indicators of Compromise</span>
                <span id="ioc-count">0 IOCs</span>
            </div>
            <div class="ioc-list" id="ioc-list"></div>
        </div>
        
        <!-- Vulnerability Panel -->
        <div class="card vuln-panel">
            <div class="card-header">
                <span class="card-title">‚ö†Ô∏è Vulnerability Management</span>
            </div>
            <div class="vuln-summary">
                <div class="vuln-stat">
                    <div class="vuln-stat-value" style="color: #ff4757;" id="vuln-critical">0</div>
                    <div class="vuln-stat-label">Critical</div>
                </div>
                <div class="vuln-stat">
                    <div class="vuln-stat-value" style="color: #ffa502;" id="vuln-high">0</div>
                    <div class="vuln-stat-label">High</div>
                </div>
                <div class="vuln-stat">
                    <div class="vuln-stat-value" style="color: #ffd43b;" id="vuln-medium">0</div>
                    <div class="vuln-stat-label">Medium</div>
                </div>
                <div class="vuln-stat">
                    <div class="vuln-stat-value" style="color: #2ed573;" id="vuln-low">0</div>
                    <div class="vuln-stat-label">Low</div>
                </div>
            </div>
            <div class="vuln-list" id="vuln-list"></div>
        </div>
        
        <!-- EDR Alerts -->
        <div class="card edr-alerts">
            <div class="card-header">
                <span class="card-title">üõ°Ô∏è EDR Detection Alerts</span>
                <span id="edr-count">0 alerts</span>
            </div>
            <div class="edr-list" id="edr-list"></div>
        </div>
        
        <!-- Compliance -->
        <div class="card compliance-section">
            <div class="card-header">
                <span class="card-title">üìã Compliance Status</span>
            </div>
            <div class="compliance-grid" id="compliance-grid"></div>
        </div>
    </main>
    
    <script>
        const threatSources = ['AlienVault OTX', 'MISP', 'VirusTotal', 'Mandiant', 'CrowdStrike', 'Recorded Future', 'Cisco Talos', 'Microsoft MSTIC'];
        
        const threatIntelTypes = [
            { title: 'APT29 Campaign Detected', tags: ['APT', 'Russia', 'Espionage'], severity: 'critical' },
            { title: 'New Ransomware Variant', tags: ['Ransomware', 'LockBit'], severity: 'critical' },
            { title: 'Cobalt Strike Beacon IOCs', tags: ['C2', 'Red Team'], severity: 'critical' },
            { title: 'Phishing Kit Infrastructure', tags: ['Phishing', 'Credential Theft'], severity: 'high' },
            { title: 'Supply Chain Compromise', tags: ['Supply Chain', 'NPM'], severity: 'high' },
            { title: 'Zero-Day Exploit Active', tags: ['0-day', 'CVE-2024'], severity: 'critical' },
            { title: 'Cryptominer Distribution', tags: ['Cryptominer'], severity: 'medium' }
        ];
        
        const cveList = [
            { id: 'CVE-2024-21887', title: 'Ivanti Connect Secure RCE', cvss: 9.8, severity: 'critical', affected: '47 systems' },
            { id: 'CVE-2024-1709', title: 'ConnectWise Auth Bypass', cvss: 10.0, severity: 'critical', affected: '12 systems' },
            { id: 'CVE-2024-3094', title: 'XZ Utils Backdoor', cvss: 10.0, severity: 'critical', affected: '156 systems' },
            { id: 'CVE-2024-6387', title: 'OpenSSH RegreSSHion', cvss: 8.1, severity: 'high', affected: '312 systems' }
        ];
        
        const edrAlertTypes = [
            { type: 'Malware Detected', category: 'malware', details: ['Trojan.GenericKD', 'Ransomware.Locky', 'Backdoor.Cobalt'] },
            { type: 'Suspicious Process', category: 'suspicious', details: ['PowerShell encoded command', 'LSASS memory access'] },
            { type: 'PUP Detected', category: 'pup', details: ['Adware.BrowserModifier', 'PUP.ToolbarInstaller'] },
            { type: 'Threat Blocked', category: 'blocked', details: ['Exploit attempt blocked', 'C2 connection blocked'] }
        ];
        
        const complianceFrameworks = [
            { name: 'NIST CSF' }, { name: 'ISO 27001' }, { name: 'PCI-DSS' },
            { name: 'HIPAA' }, { name: 'SOC 2' }, { name: 'CIS Controls' }
        ];
        
        let endpoints = [];
        let iocs = [];
        let edrAlerts = [];
        let currentFilter = 'all';
        let searchTerm = '';
        
        function generateEndpoints() {
            const types = [
                { prefix: 'WKS', icon: 'üíª', type: 'Workstation' },
                { prefix: 'SRV', icon: 'üñ•Ô∏è', type: 'Server' },
                { prefix: 'LPT', icon: 'üíº', type: 'Laptop' }
            ];
            const statuses = ['healthy', 'healthy', 'healthy', 'healthy', 'warning', 'warning', 'critical', 'offline'];
            
            for (let i = 0; i < 50; i++) {
                const typeInfo = types[Math.floor(Math.random() * types.length)];
                endpoints.push({
                    id: `${typeInfo.prefix}-${String(Math.floor(Math.random() * 999) + 1).padStart(3, '0')}`,
                    type: typeInfo.type,
                    icon: typeInfo.icon,
                    status: statuses[Math.floor(Math.random() * statuses.length)]
                });
            }
        }
        
        function generateIOC() {
            const types = ['ip', 'hash', 'domain', 'url', 'cve'];
            const type = types[Math.floor(Math.random() * types.length)];
            let value;
            switch(type) {
                case 'ip': value = `${Math.floor(Math.random() * 223) + 1}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`; break;
                case 'hash': value = Array(32).fill(0).map(() => '0123456789abcdef'[Math.floor(Math.random() * 16)]).join(''); break;
                case 'domain': value = `${Math.random().toString(36).substring(7)}.malware.com`; break;
                case 'url': value = `https://mal${Math.random().toString(36).substring(7)}.com/payload.exe`; break;
                case 'cve': value = `CVE-2024-${Math.floor(Math.random() * 9999)}`; break;
            }
            return { type, value, confidence: ['high', 'medium', 'low'][Math.floor(Math.random() * 3)], source: threatSources[Math.floor(Math.random() * threatSources.length)] };
        }
        
        function generateEDRAlert() {
            const template = edrAlertTypes[Math.floor(Math.random() * edrAlertTypes.length)];
            const endpoint = endpoints[Math.floor(Math.random() * endpoints.length)];
            return {
                type: template.type,
                category: template.category,
                detail: template.details[Math.floor(Math.random() * template.details.length)],
                endpoint: endpoint.id,
                user: ['SYSTEM', 'admin', 'jsmith'][Math.floor(Math.random() * 3)],
                time: new Date()
            };
        }
        
        function renderThreatFeed() {
            document.getElementById('threat-feed').innerHTML = threatIntelTypes.map(threat => `
                <div class="threat-card ${threat.severity}">
                    <div class="threat-source"><span>üì°</span><span>${threatSources[Math.floor(Math.random() * threatSources.length)]}</span><span style="margin-left: auto; color: #666;">${Math.floor(Math.random() * 60)}m ago</span></div>
                    <div class="threat-title">${threat.title}</div>
                    <div class="threat-tags">${threat.tags.map(tag => `<span class="threat-tag">${tag}</span>`).join('')}</div>
                </div>
            `).join('');
        }
        
        function renderEndpoints() {
            let filtered = endpoints;
            if (currentFilter !== 'all') filtered = filtered.filter(e => e.status === currentFilter);
            if (searchTerm) filtered = filtered.filter(e => e.id.toLowerCase().includes(searchTerm.toLowerCase()));
            
            document.getElementById('endpoint-grid').innerHTML = filtered.map(ep => `
                <div class="endpoint-tile">
                    <div class="endpoint-icon">${ep.icon}</div>
                    <div class="endpoint-name">${ep.id}</div>
                    <div class="endpoint-details"><span class="endpoint-status-indicator ${ep.status}"></span>${ep.status}</div>
                </div>
            `).join('');
            
            document.getElementById('endpoint-total').textContent = `${filtered.length} endpoints`;
            document.getElementById('healthy-count').textContent = endpoints.filter(e => e.status === 'healthy').length;
            document.getElementById('warning-count').textContent = endpoints.filter(e => e.status === 'warning').length;
            document.getElementById('critical-count').textContent = endpoints.filter(e => e.status === 'critical').length;
            document.getElementById('offline-count').textContent = endpoints.filter(e => e.status === 'offline').length;
        }
        
        function renderIOCs() {
            document.getElementById('ioc-list').innerHTML = iocs.slice(0, 12).map(ioc => `
                <div class="ioc-item">
                    <span class="ioc-type-badge ${ioc.type}">${ioc.type.toUpperCase()}</span>
                    <span class="ioc-value" title="${ioc.value}">${ioc.value}</span>
                    <span class="ioc-confidence confidence-${ioc.confidence}">${ioc.confidence.toUpperCase()}</span>
                </div>
            `).join('');
            document.getElementById('ioc-count').textContent = `${iocs.length} IOCs`;
        }
        
        function renderVulnerabilities() {
            document.getElementById('vuln-list').innerHTML = cveList.map(vuln => `
                <div class="vuln-item ${vuln.severity}">
                    <div class="vuln-header"><span class="vuln-cve">${vuln.id}</span><span class="vuln-cvss cvss-${vuln.severity}">CVSS ${vuln.cvss}</span></div>
                    <div class="vuln-title">${vuln.title}</div>
                    <div class="vuln-affected">Affected: ${vuln.affected}</div>
                </div>
            `).join('');
            document.getElementById('vuln-critical').textContent = cveList.filter(v => v.severity === 'critical').length;
            document.getElementById('vuln-high').textContent = cveList.filter(v => v.severity === 'high').length;
            document.getElementById('vuln-medium').textContent = 12;
            document.getElementById('vuln-low').textContent = 34;
        }
        
        function renderEDRAlerts() {
            document.getElementById('edr-list').innerHTML = edrAlerts.slice(0, 6).map(alert => `
                <div class="edr-alert ${alert.category}">
                    <div class="edr-header"><span class="edr-type">${alert.type}</span><span class="edr-time">${formatTime(alert.time)}</span></div>
                    <div class="edr-details">${alert.detail}<div class="edr-details-row"><div class="edr-detail"><span class="edr-detail-label">Host:</span><span>${alert.endpoint}</span></div><div class="edr-detail"><span class="edr-detail-label">User:</span><span>${alert.user}</span></div></div></div>
                </div>
            `).join('');
            document.getElementById('edr-count').textContent = `${edrAlerts.length} alerts`;
        }
        
        function renderCompliance() {
            document.getElementById('compliance-grid').innerHTML = complianceFrameworks.map(fw => {
                const score = Math.floor(Math.random() * 30) + 70;
                const color = score >= 90 ? '#2ed573' : score >= 75 ? '#ffa502' : '#ff4757';
                return `<div class="compliance-item"><div class="compliance-score" style="color: ${color}">${score}%</div><div class="compliance-label">${fw.name}</div><div class="compliance-bar"><div class="compliance-fill" style="width: ${score}%; background: ${color}"></div></div></div>`;
            }).join('');
        }
        
        function formatTime(date) { return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' }); }
        
        function updateDateTime() {
            document.getElementById('datetime').textContent = new Date().toLocaleString('en-US', { weekday: 'short', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }
        
        document.getElementById('endpoint-search').addEventListener('input', e => { searchTerm = e.target.value; renderEndpoints(); });
        document.getElementById('status-filter').addEventListener('change', e => { currentFilter = e.target.value; renderEndpoints(); });
        
        function init() {
            generateEndpoints();
            for (let i = 0; i < 15; i++) iocs.push(generateIOC());
            for (let i = 0; i < 8; i++) { const alert = generateEDRAlert(); alert.time = new Date(Date.now() - Math.random() * 3600000); edrAlerts.push(alert); }
            edrAlerts.sort((a, b) => b.time - a.time);
            
            renderThreatFeed();
            renderEndpoints();
            renderIOCs();
            renderVulnerabilities();
            renderEDRAlerts();
            renderCompliance();
            updateDateTime();
            
            setInterval(updateDateTime, 1000);
            setInterval(() => { iocs.unshift(generateIOC()); if (iocs.length > 30) iocs.pop(); renderIOCs(); }, 5000);
            setInterval(() => { edrAlerts.unshift(generateEDRAlert()); if (edrAlerts.length > 15) edrAlerts.pop(); renderEDRAlerts(); }, 8000);
        }
        
        init();
    </script>
</body>
</html>
